<script>
  function updateTime() {
    const now = new Date();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const year = now.getFullYear();
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    document.getElementById('datetime').innerText = month + '/' + day + '/' + year + ' ' + hours + ':' + minutes + ':' + seconds;
  }

  setInterval(updateTime, 1000);
  updateTime();

  // Moon phase descriptions
  const moonDescriptions = {
    'ðŸŒ‘': 'New Moon',
    'ðŸŒ’': 'Waxing Crescent',
    'ðŸŒ“': 'First Quarter',
    'ðŸŒ”': 'Waxing Gibbous',
    'ðŸŒ•': 'Full Moon',
    'ðŸŒ–': 'Waning Gibbous',
    'ðŸŒ—': 'Last Quarter',
    'ðŸŒ˜': 'Waning Crescent'
  };

  // Fetch with cache bust for fresh moon phase
  const cacheBust = Date.now();
  fetch(`https://wttr.in/Rocklin?format="%c %t %h %w %P %m"&u&t=${cacheBust}`)
    .then(r => r.text())
    .then(text => {
      let cleaned = text.trim()
        .replace(/"/g, '')
        .replace(/\s+/g, ' ')
        .replace(/^\+/, '')
        .replace(/\(.*?\)/g, '')
        .replace(/hPa|Pa|mm|cm|km\/h|C|Â°C|Pa|1025|in\([^)]*\)/g, '')
        .trim();

      const parts = cleaned.split(' ');
      let moonEmoji = parts.pop() || '';
      if (!/[ðŸŒ‘ðŸŒ’ðŸŒ“ðŸŒ”ðŸŒ•ðŸŒ–ðŸŒ—ðŸŒ˜]/.test(moonEmoji)) moonEmoji = '';
      const weatherStr = parts.join(' ');

      document.getElementById('weather').innerText = weatherStr || 'No weather data';
      document.getElementById('moon-emoji').innerText = moonEmoji;
      document.getElementById('moon-desc').innerText = moonDescriptions[moonEmoji] || '';
    })
    .catch(() => {
      document.getElementById('weather').innerText = 'Weather load failed';
    });
</script>
